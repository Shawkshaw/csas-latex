% appendix-equations.tex
% iSCAM model equations

\def\beq{\vspace{-5ex} \begin{fleqn} \begin{equation}}
\def\eeq{\end{equation} \end{fleqn} \vspace{-5ex}}
\def\tabline{\vspace{2ex} \hrule \vspace{2ex}}
%\def\vsd{\vspace*{1ex}}
\def\newp{\vfill \break}

\clearpage

\chapter{MODEL DESCRIPTION AND EQUATIONS}

\section{INTRODUCTION}

Stock Assessment modelling was conducted using the Integrated Statistical Catch Age Model (iSCAM), developed by Steven J.D. Martell (Martell et al. 2011).  iSCAM is written in AD Model Builder and the source code and documentation for the original iSCAM is available at https://github.com/smartell/iSCAM.  iSCAM uses a statistical catch-at-age model implemented in a Bayesian estimation framework.

The version of iSCAM used for this assessment is based on a more recent “IPHC-developers” version, also developed by S. Martell, that models males and females separately and includes a length-based option for modelling selectivity (also available at https://github.com/smartell/iSCAM).  Further modifications to the IPHC-developers branch have been made by the first author of this assessment (K.R. Holt) to allow density-dependent natural mortality and non-linear catchability options for Strait of Georgia Lincgod (see https://github.com/krholt/iSCAM-pbs-lingcod).

Running of iSCAM and compilation of results figures was streamlined using the iscam-gui software package developed by Chris Grandin (pers. comm, Pacific Biological Station, Fisheries and Oceans Canada).  iscam-gui is written in R (R Development Core Team, 2012), and provides an R gui interface that allows users to run and show output of multiple iSCAM model runs next to each other.

This appendix contains the documentation in mathematical form of the underlying iSCAM age-structured model, and its steady state version that is used to calculate reference points, the observation models used in predicting observations, and the components of the objective function that formulate the the objective function that is used to estimate model parameters.  All of the model equations are laid out in tables and are intended to represent the order of operations, or pseudocode, in which to implement the model.  A documented list of symbols used in model equations is given in Table~\ref{tab:variables}. The documentation presented here is a revised version of the iscam user-guide written by S. Martell and available at https://github.com/smartell/iSCAM.  Much of the text and equations have been taken directly from the original users guide, with modifications by K.R. Holt to describe the expansion to a two-sex model and the additional lingcod options.

\section{ANALYTIC METHODS: EQUILIBRIUM CONSIDERATIONS}

\subsection{A Steady-State Age-Structured Model}

For the steady-state conditions represented in Table~\ref{tab:model}, we assume the parameter vector $\Theta$ in \ref{eq:df1} is unknown and would eventually be estimated by fitting iSCAM to data.  For a given set of sex-specific growth parameters and maturity-at-age parameters defined by \ref{eq:df2}, growth is assumed to follow von Bertalanffy \ref{eq:df3}, mean weight-at-age is given by the allometric relationship in \ref{eq:df4}, and the age- and sex-specific vulnerability is given by a length-based logistic function \ref{eq:df5}. Note, there are alternative selectivity functions implemented in iSCAM; the length-based logistic function is shown here because it is used to model selectivity to the only current lingcod fishery in the Strait of Georgia (the recreational fishery with a 65cm minimum size limit). Mean fecundity-at-age by sex is assumed to be proportional to the mean weight-at-age of mature fish, where maturity at age is specified by the sex-specific parameters $\dot{a}_s$ and $\dot{\gamma}_s$ for the logistic function.

\clearpage

% \baselineskip 2.5ex \vspace{-2ex}
% ********************** Table 1 ************************************
\begin{table}[b]
\centering
\caption{\label{tab:variables} A list of symbols, constants and description for variables used in iSCAM.  The symbol * after a value indicates that the fixed value was changed for different 2014 assessment scenarios.}
\begin{tabular}{lll}
\hline
\bf{Symbol} & \bf{Value} & \bf{Description} \\
\hline
%\hline \ \\[-.5ex]
%
\multicolumn{3}{l}{\underline{Indices}}\\
$s$ & & Index for sex\\
$a$ & & Index for age\\
$t$ & & Index for year\\
$k$ & & Index for gear\\
\multicolumn{3}{l}{\underline{Model dimensions}}\\
$S$             & 2             & Number of sexes\\
$\acute{a}, A$  & 1, 20         & Youngest and oldest age class ($A$ is a plus group)\\
$\acute{t}, T$  & 1927, 2013    & First and last year of catch data\\
$K$             & 5             & Number of gears including survey gears\\
\multicolumn{3}{l}{\underline{Observations (data)}}\\
$C_{k,t}$       & & catch in weight by gear $k$ in year $t$\\
$I_{k,t}$       & & relative abundance index for gear $k$ in year $t$\\
%$p_{k,t,a}$     & & observed proportion-at-age $a$ in year $t$ for gear $k$\\
\multicolumn{3}{l}{\underline{Fixed parameters}}\\
$M$                 &0.20* & Instantaneous natural mortality rate \\
%$M_{zero}$                 &0.18* & Instantaneous natural mortality rate at zero abundance \\
$\rho$              &0.98* & Fraction of the total variance associated with observation error\\
%$\vec{\gamma}_k$    & & Vector of selectivity parameters for gear $k$ \\
$\hat{a}_k, \hat{\gamma}_k$    &See Table~\ref{tab:datasets} & Selectivity parameters for gear $k$ \\
%$\lambda_{pow  \;  k}$    &See Table x.x & Exponent determining degree of denstiy-dependent catchability for gear $k$ \\
\multicolumn{3}{l}{\underline{Estimated parameters}}\\
$R_o$               & & Age-$\acute{a}$ recruits in unfished conditions\\
$\kappa$            & & Recruitment compensation\\
$\bar{R}$           & & Average age-$\acute{a}$ recruitment from year $\acute{t}$ to $T$\\
%$\ddot{R}$          & & Average age-$\acute{a}$ recruitment in year $\acute{t}-1$\\
$\vartheta$         & & Total precision (inverse of variance) of the total error\\
$\Gamma_{k,t}$    & & Logarithm of the instantaneous fishing mortality for gear $k$ in year $t$\\
%$\ddot{\omega}_a$   & & Age-$\acute{a}$ deviates from $\ddot{R}$ for year $\acute{t}$\\
$\omega_t$          & & Age-$\acute{a}$ deviates from $\bar{R}$ for years $\acute{t}$ to $T$\\
\multicolumn{3}{l}{\underline{Standard deviations}}\\
%$\sigma_M$          &0.1    & standard deviation in random walk for natural mortality\\
$\sigma$            &       & Standard deviation for observation errors in survey index\\
$\tau$              &       & Standard deviation in process errors (recruitment deviations)\\
$\sigma_C$          &0.25 & Standard deviation in observed catch by gear\\
\multicolumn{3}{l}{\underline{Residuals}}\\
$\delta_t$      &   & Annual recruitment residual\\
$\eta_t$        &   & Residual error in predicted catch\\
\multicolumn{3}{l}{\underline{Growth \& maturity parameters}}\\
$l_{\infty  s}$ &  900 / 1040 &  Asymptotic length in mm for males / females \\
$\acute{k}_s$ & 0.20 / 0.20 & Brody growth coefficient for males / females \\
$t_{o s}$ & -0.001 / -0.001 & Theoretical age at zero length for males / females \\
$\acute{a}_s$ & 1.13e{-11} / 1.13e{-11} &  Scaler in length- weight allometry (mm to 100's of kg)\\
$\acute{b}_s$ & 3.329 / 3.329 &Power parameter in length-weight allometry for males / females\\
$\dot{a}_s$ & 2.0 / 5.0 & Age at 50\% maturity for males / females \\
$\acute{\gamma}_s$ & 0.001 / 0.20 & Standard deviation at 50\% maturity for males / females\\
\hline
\end{tabular}
\end{table}

%\newp % \baselineskip \mybaselineskip

% ********************** Table 2 ************************************
\begin{table}[b]
\centering
\caption{\label{tab:model} Steady-state age-structured model assuming unequal vulnerability-at-age, age-specific fecundity and Ricker type recruitment.}
\begin{tabular}{ll}
\hline \\
\multicolumn{2}{c}{\bf{Parameters}} \\
\vbox{\beq \Theta = (B_o,\kappa)\,; \ \ \ B_o>0; \kappa > 1 \label{eq:df1} \eeq} \\
\vbox{\beq \Phi = (l_{\infty,s},\acute{k}_s, t_{o,s},\acute{a}_s,\acute{b}_s,\dot{a}_s,\dot{\gamma}_s,\hat{a},\hat{\gamma}, M) \label{e1:df2} \eeq} \\
\vspace{2ex} \\
\multicolumn{2}{c}{\bf{Age-schedule information}} \\
\vbox{\beq  l_{a,s}=l_{}(1-e^{(-k_s(a-t_{o,s}))}) \label{eq:df3} \eeq} \\
\vbox{\beq  w_{a,s}=\acute{a}_s(l_{a,s})^{\acute{b}_s} \label{eq:df4} \eeq} \\
\vspace{2.25ex} \\
%\vbox{\beq  v_a=\frac{1}{(1+e^{(-(\hat{a}-a)/\hat{\gamma})})} \label{eq:df5} \eeq} \\
\vbox{\beq  v_a=\frac{1}{\left(1+e^{(-\frac{(\hat{a}-a)}{\hat{\gamma}})}\right)} \label{eq:df5} \eeq} \\

%% \beq  v_{a,s}=(1+\exp(-(\hat{a}-l_{a,s})/\hat{\gamma}))^{-1}   \label{eq:df5} \eeq \vsd \vsd \vsd

%% \beq  f_{a,s}=w_{a,s}(1+\exp(-(\dot{a}_s-a)/\dot{\gamma}_s))^{-1} \label{eq:df6} \eeq \vsd \vsd \vsd

%% \bec {\bf Survivorship} \eec

%% \begin{fleqn}     % \beq puts -ve vspace, not good for { ...
%% \begin{equation}
%% \iota_a = \left\{
%% \begin{array}{lll}
%% 1 / S, & a=1\\
%% \iota_{a-1}e^{-M}, & a > 1 \\
%% \iota_{a-1}/(1-e^{-M}),  & a = A
%% \label{eq:df7}
%% \end{array}
%% \right.
%% \end{equation}
%% \end{fleqn}
%% \vspace{-5ex}

%% \begin{fleqn}    .
%% \begin{equation}
%% \hat{\iota}_{a,s} = \left\{
%% \begin{array}{lll}
%% 1 / S, & a=1\\
%% \hat{\iota}_{a-1,s}e^{-M -F_e v_{a-1,s}}, & a > 1 \\
%% \hat{\iota}_{a-1,s}e^{-M -F_e v_{a-1,s}} / (1-e^{-M-F_e v_{a,s}}), & a = A
%% \label{eq:df8}
%% \end{array}
%% \right.
%% \end{equation}
%% \end{fleqn}
%% \vspace{2ex}

%% \bec {\bf Incidence functions} \eec

%% \vspace{2ex}

%% \beq \phi_E=\sum_{s=1}^S\sum_{a=1}^\infty \iota_a f_{a,s}, \quad
%% \phi_e=\sum_{s=1}^S\sum_{a=1}^\infty \hat{\iota}_{a,s} f_{a,s}          \label{eq:df9} \eeq \vsd \vsd \vsd

%% \vspace{2ex}

%% \beq \phi_B=\sum_{s=1}^S\sum_{a=1}^\infty \iota_a w_{a,s} v_{a,s}, \quad
%% \phi_b=\sum_{s=1}^S\sum_{a=1}^\infty \hat{\iota}_{as} w_{a,s} v_{a,s}       \label{eq:df10} \eeq \vsd \vsd \vsd

%% \vspace{2ex}

%% \beq\phi_q=\sum_{s=1}^S\sum_{a=1}^\infty
%%                 \frac{ \hat{\iota}_{a,s} w_{a,s} v_{a,s}}{M+F_ev_{a,s}}
%%                 \left(1-e^{(-M-F_ev_{a,s})}\right)               \label{eq:df11} \eeq \vsd \vsd \vsd

%% \bec {\bf Steady-state conditions} \eec

%% \beq R_o=B_o/ \phi_B   \label{eq:df12} \eeq \vsd \vsd \vsd

%% \vsd
%% % If using Ricker, use:
%% \beq R_e=R_o \dfrac{\ln(\kappa)-\ln(\phi_E/\phi_e)}{\ln(\kappa)}  \label{eq:df13} \eeq \vsd \vsd \vsd

%% % If using Beverton Holt, use:
%% %\beq R_e=R_o \dfrac{\kappa-\phi_E/\phi_e}{\kappa-1}  \label{df13} \eeq \vsd \vsd \vsd

%% \vsd
%% \beq C_e=F_e R_e \phi_q   \label{eq:df14} \eeq \vsd \vsd \vsd
%\hline
\end{tabular}
\end{table}
%\noindent \hrule %\tabline
%\newp

%% Survivorship for unfished and fished populations is defined by \ref{eq:df7} and \ref{eq:df8}, respectively. Note that fished survivorship is sex-specifric to allow for sex-specific $v_{a,s}$ when the length-based logistic function is used to model vulnerability. It is assumed that all individuals ages $A$ and older (i.e., the plus group) have the same total mortality rate. The incidence functions refer to the life-time or per-recruit quantities such as spawning biomass per recruit ($\phi_E$) or vulnerable biomass per recruit ($\phi_b$). Note that upper and lower case subscripts denote unfished and fished conditions, respectively. Spawning biomass per recruit is given by \ref{eq:df9}, the vulnerable biomass per recruit is given by \ref{eq:df10} and the per recruit yield to the fishery is given by \ref{eq:df11}. Unfished recruitment is given by \ref{eq:df12} and the steady-state equilibrium recruitment  for a given fishing mortality rate $F_e$ is given by \ref{eq:df13}.  Note that in \ref{eq:df13} we assume that recruitment follows a  Ricker stock recruitment model of the form:
%% \[
%% R_e=%\begin{cases}
%% %    \dfrac{s_o R_e \phi_e}{1+\beta R_e \phi_e},& \mbox{Beverton-Holt}\\[5ex]
%%     s_o R_e \phi_e \exp(-\beta R_e \phi_e) %& \mbox{Ricker}
%% %\end{cases}
%% \]
%% where the maximum juvenile survival rate is given by:
%% \[
%% s_o = \kappa/\phi_E,
%% \]
%% and the density-dependent term is given by:
%% \[
%% \beta = %\begin{cases}
%% %    \dfrac{(\kappa-1)}{R_o\phi_E}, & \mbox{Beverton-Holt}\\[5ex]
%%     {\dfrac {\ln  \left( \kappa \right) }{R_{{o}}\phi_{{E}}}}, %& \mbox{Ricker}
%% %\end{cases} 
%% \]
%% which simplifies to \ref{eq:df13}.

%% The equilibrium yield for a given fishing mortality rate is \ref{eq:df14}. These steady-state conditions are critical for determining various reference points such as $F_{MSY}$ and $B_{MSY}$.

%% \subsection{MSY-based Reference Points}

%% When defining reference points for this assessment, only the current recreational fishery (with a 65cm size limit) was used to calculate MSY quantities.  In the case of a single fishery such as this, iSCAM calculates $F_{MSY}$ by finding the value of $F_e$ that results in the zero derivative of  \ref{eq:df14}. This is accomplished numerically using a Newton-Raphson method where an initial guess for $F_{MSY}$ is set equal to 1.0$M$.  Given an estimate of $F_{MSY}$, other reference points such as MSY are calculated using the equations in Table~\ref{tab:model}.

%% A special class library to implement the MSY-based reference point calculations was developed specifically for iSCAM. Details of this algorithm, including partial derivatives for the numerical calculation of $F_{MSY}$, are available in the original iscam documentation available at: https://github.com/smartell/iSCAM.

%% %\subsub{MSY-based Reference Points: Density-dependent $M$}


%% %\newp % \baselineskip \mybaselineskip

%% \section{ANALYTIC METHODS: STATE DYNAMICS}

%% The estimated parameter vector in iSCAM is defined in \ref{eq:df15} of Table~\ref{tab:cam}. The unknown parameters $R_0$ and $\kappa$, as well as the fixed parameter $M$, are the leading population parameters that define the overall population scale.  The total variance $\vartheta^2$ is estimated, while the proportion of the total variance that is associated with observation errors $\rho$ is assumed fixed. The total variance is partitioned into observation errors ($\sigma^2$) and process errors ($\tau^2$) using \eqref{eq:df16}.

%% The unobserved state variables \eqref{eq:df17} include the numbers-at-age in year $t$ of sex $s$ ($N_{t,a,s}$), the spawning stock biomass in year $t$ of sex $s$ ($B_t$), and the total age- and sex-specific total mortality rate ($Z_{t,a,s}$).

%% The initial numbers-at-age in the first year \ref{eq:df18} and the annual recruits \ref{eq:df19} are treated as estimated parameters and used to initialize the numbers-at-age array.  Recruitment at age-1 is assumed to be 50\% males and 50\% females. When a length-based selectivity function is used (i.e. for the Strait of Georgia Lingcod Recreational Fishery with a 65cm size limit; Table~\ref{tab:datasets}), age- and sex-specific selectivity for gear type $k$ is a function of the selectivity parameters ($a_k$ and $\gamma_k$, which represent length at 50\% selectivity and the associated standard deviation, respectively) and the sex-specific length-at-age $a$, $l_{a,s}$, as shown in \ref{eq:df20}.  For the two Strait of Georgia Lingcod fisheries modelled using age-based logisitc selectivity (Table~\ref{tab:datasets}), the $l_{a,s}$ variable in equation \ref{eq:df20} is replaced with age $a$, and the selectivity parameters($a_k$ and $\gamma_k$) would be based on mean age of selectivity and the assocaited standard deviation  In this latter case, vulberability at age for these gears would be the same for males and females.  The annual fishing mortality for each gear $k$ in year $t$ is the exponent of the estimated vector $\Gamma_{k,t}$ \ref{eq:df21}.  The vector of log fishing mortality rate parameters $\Gamma_{k,t}$ is a bounded vector with a minimum value of -30 and an upper bound of 3.0.  In arithmetic space this corresponds to a minimum value of 9.36e-14 and a maximum value of 20.01 for annual fishing mortality rates.  In years where there are 0 reported catches for a given fleet, no corresponding fishing mortality rate parameter is estimated and the implicit assumption is there was no fishery in that year.

%% State variables in each year are updated using equations \ref{df22}--\ref{df25}, where the spawning biomass is the product of the numbers-at-age and the mature biomass-at-age \ref{eq:df22}.  The total mortality rate is given by \ref{eq:df23}, and the total catch (in weight) for each gear is given by \ref{eq:df24}, assuming that both natural and fishing mortality occur simultaneously throughout the year.  Lingcod catch was not differentiated by sex, so both sexes were combined to calculate a total catch in \ref{eq:df24}.  The sex-specific numbers-at-age are propagated over time using \ref{eq:df25}, where members of the plus group (age $A$) are all assumed to have the same total mortality rate.  

%% Recruitment to age $k$ is assumed to follow a Ricker model for Strait of Gerogia Lingcod \ref{eq:df26} where the maximum juvenile survival rate ($s_o$) is defined by $s_o=\kappa/\phi_E$.  For the Ricker model, $\beta$ is derived by solving \ref{eq:df26} for $\beta$ conditional on estimates of $\kappa$ and $R_o$:
%% \[
%% \beta = \frac{\ln(\kappa)}{R_o \phi_E}
%% \]


%% \subsection{Option for Density-Dependent Natural Mortality}

%% The option to specify density-dependent mortality was added to the version of iSCAM used for this assessment to allow replication of the 2005 assessment for the bridging analysis.  Density-dependent mortality was implemented in the same way as the 2005 assessment (Logan et al. 2005):
%% \[
%% M_t = M_0 + (M_{zero} - M_0)(1 - \frac{B_t}{B_0})
%% \]
%% where, $B_t$ is total biomass (males and females combined) in year $t$, $M_t$ is the natural mortality at stock biomass $B_t$, $M_0$ is natural mortality at unfished biomass (i.e., carrying capacity), and $M_{zero}$ is natural mortality at negligible stock size.

%% Both $M_0$ and $M_zero$ were fixed at the same parameter values assumed by Logan et al. (2005).  $M_0$ was set at 0.2 and $M_zero$ was set at 0.18.

%% Need to add chages to reference point calculations .....

%% \newp % \baselineskip \mybaselineskip

%% % ********************** Table 3 ************************************

%% \leftskip=1.5em	   %indents caption (that isn't done as a caption)
%% \parindent=-1.5em  % then revert back afterwards
%% \begin{table}[b]
%% \centering
%% \caption{\label{tab:cam} Statistical catch-age model using the Baranov catch equation.}

%% \leftskip=0em
%% \parindent=-0em

%% % \seteq{L}

%% \bec {\bf Estimated parameters} \eec \vspace{1ex}

%% \beq \Theta= (R_0,\kappa,\bar{R},\vartheta^2,\Gamma_{k,t},\{\omega_t\}_{t=1-A}^{t=T})  \label{df15} \eeq \vsd \vsd \vsd

%% \vspace{2ex}

%% \beq \sigma^2=\rho /\vartheta^2, \;  \;  \; \; \tau^2=(1-\rho)/\vartheta^2 \label{df16} \eeq \vsd \vsd \vsd

%% \bec {\bf Unobserved states} \eec \vspace{1ex}

%% \beq N_{t,a},\; B_t,\; Z_{t,a}  \label{df17} \eeq \vsd \vsd \vsd

%% \bec {\bf Initial states} \eec \vspace{1ex}

%% \beq N_{t,a,s}=\frac{1}{S}\bar{R}e^{\omega_{t-a}} \exp(-M)^{(a-1)};\quad t=1;  2\leq a\leq A \label{df18} \eeq \vsd \vsd \vsd

%% \vspace{2ex}
%% \beq N_{t,a,s}=\frac{1}{S}\bar{R}e^{\omega_{t}} ;\quad 1\leq t\leq T;  a=1 \label{df19} \eeq \vsd \vsd \vsd

%% \vspace{2ex}
%% \beq v_{k,a,s}= \frac{1}{1+exp(-(l_{a,s} - \hat{a}_k)/ \hat{\gamma}_k)}    \label{df20} \eeq \vsd \vsd \vsd

%% \vspace{2ex}
%% \beq  F_{k,t}=\exp(\Gamma_{k,t})  \label{df21} \eeq \vsd \vsd \vsd

%% \bec {\bf State dynamics (t $>$ 1)} \eec \vspace{1ex}

%% \beq  B_{t,s}=\sum_a N_{t,a,s}f_{a,s} \label{df22} \eeq \vsd \vsd \vsd

%% \vspace{2ex}
%% \beq  Z_{t,a,s}=M+\sum_k F_{k,t} v_{k,t,a,s}  \label{df23} \eeq \vsd \vsd \vsd

%% \vspace{2ex}
%%  \beq \hat{C}_{k,t}=\sum _ s\sum _ a\frac {N_{{t,a,s}}w_{{a,s}}F_{k,t} v_{{k,t,a,s}}
%%         \left( 1-{e^{-Z_{t,a,s}}} \right) }{Z_{t,a,s}}^{\eta_t}  \label{df24} \eeq \vsd \vsd \vsd

%% \vspace{3ex}
%%  \beq N_{t,a,s}=\begin{cases}
%%             %\dfrac{s_oE_{t-1}}{1+\beta E_{t-1}} \exp(\omega_t-0.5\tau^2) &a=1\\ \\
%%             N_{t-1,a-1,s} \exp(-Z_{t-1,a-1,s}) &a>1\\
%%             N_{t-1,a,s} \exp(-Z_{t-1,a,s}) & a=A
%%         \end{cases} \label{df25} \eeq \vsd \vsd \vsd

%% \bec {\bf Recruitment model} \eec \vspace{1ex}

%% \vspace{1ex}
%% % If using Ricker:
%% \beq R_t = s_oB_{t-k}e^{-\beta B_{t-k}+\delta_t-0.5\tau^2}  \label{df26} \eeq \vsd \vsd \vsd

%% % If using Beverton-Holt:
%% %\beq R_t &= \frac{s_oB_{t-k}}{1+\beta B_{t-k}}e^{\delta_{t}-0.5\tau^2}   \label{df26} \eeq \vsd \vsd \vsd
%% \end{table}

%% \noindent \hrule %\tabline

%% \clearpage

%% % ********************** Table 4 ************************************
%% \begin{table}[b]
%% \centering
%% %\leftskip=1.5em
%% %\parindent=-1.5em
%% \caption{\label{tab:datasets} Definition of datasets denoted by gear index $k$ in Tables~\ref{tab:variables} - ~\ref{tab:cam}.}
%% %\vsd \\
%% \leftskip=0em
%% \parindent=-0em
%% \begin{center}
%% \begin{tabular}{llcccc} 
%% \hline \\[-1.5ex]
%%               &                      & Years with     & Years with    &  Selectivity    &  Selectivity \\ 
%% $k$	    &Dataset  	       &  Catch Data  & CPUE Index  &  Type           &  Parameters($\hat{a}, \hat{\gamma}$ ) \\ 

%% \hline %\\[-.5ex]

%% 1 &  Commercial fishery & 1927-1989 & 1962-1989 & Age-based & (4.45, 0.2) \\
%% 2 &  Rec. fishery; limit $\leq$ 580mm & 1962-1990 & 1982-2013 & Age-based& (2.00, 0.2) \\
%% 3 &  Rec. fishery; limit = 650mm & 1991-2013 & - & Length-based & (650, 15) \\

%% \hline 
%% \end{tabular} 
%% \vsd
%% \end{center}
%% \end{table}

%% \medskip


%% \section{RESIDUALS, LIKELIHOODS, AND OBJECTIVE FUNCTION VALUE COMPONENTS}

%% There are three major components to the overall objective function that are minimized while iSCAM is performing maximum likelihood estimation.  These components consist of the likelihood of the data, prior distributions and penalty functions that are invoked to regularize the solution during intermediate phases of the non-linear parameter estimation.  This section discusses each of these in turn, starting first with the residuals between observed and predicted states followed by the negative loglikelihood that is minimized.

%% \subsection{Catch Data}

%% It is assumed that the measurement errors in the catch observations are log-normally distributed, and the residuals given by:
%% \begin{equation}\label{df27}
%% \eta_{k,t}=\ln(C_{k,t}+o) -  \ln(\hat{C}_{k,t}+o),
%% \end{equation}
%% \begin{addmargin}[3em]{1em}
%% where $o$ is  a small constant (1.e-10) to ensure the residual is defined in the case of a 0 catch observation.
%% \end{addmargin}
%% The residuals are assumed to be normally distributed with a user-specified standard deviation $\sigma_{C}$.  At present, it is assumed that observed catches for each gear $k$  have the same standard deviation.  The negative loglikelihood (ignoring the scaling constant) for the catch data is given by:
%% \begin{equation}\label{df28}
%% \ell_C = \sum_k\left[  T_k\ln(\sigma_C)+\frac{\sum_t(\eta_{k,t})^2}{2\sigma_C^2}\right],
%% \end{equation}
%% \begin{addmargin}[3em]{1em}
%% where $T_k$ is the total number of catch observations for gear type $k$.
%% \end{addmargin}

%% Commercial fishery catch data for Area 4B Lingcod are available in biomass units (tonnes), while catch from recreational fisheries are reported as numbers (pieces).  iSCAM allows users to specify catch units as biomass or numbers; however, to accomodate the constraint that catches from all gears have the same standard deviation, we re-scale recreational catch to 10's of pieces so that it would be on the same scale as catch in tonnes from the commercial fishery.  This re-scaling required us to specifythe parameters for the allometric weight-length relationship in \ref{eq:df4} in units of mm to 100's of kg.

%% \subsection{Relative Abundance Data}

%% The relative abundance data are assumed to be proportional to biomass that is vulnerable to the sampling gear:
%% \begin{equation}\label{df29}
%%  V_{k,t} = \sum_s \sum_a N_{t,a,s} e^{-\lambda_{k,t} Z_{t,a,s}} v_{k,a,s} w_{a,s},
%% \end{equation}
%% \begin{addmargin}[3em]{1em}
%% where $v_{k,a,s}$ is the sex- and age-specific selectivity of gear $k$, and $w_{a,s}$ is the mean-weight-at-age for sex $s$.
%% \end{addmargin}
%% A user-specified fraction of the total mortality $\lambda_{k,t}$ adjusts the numbers-at-age to correct for survey timing.  We set $\lambda_{k,t}$ to 0.5 for all index observations in the commercial and recreational CPUE indices since fishery catch and the collection of CPUE data are the same process, and natural mortality occures throughout the fishing season. 

%% The residuals between the observed and predicted relative abundance index is given by:
%% \begin{equation}\label{df30}
%% \epsilon_{k,t} = \ln(I_{k,t}) - \ln(q_k)+\ln(V_{k,t}),
%% \end{equation}
%% \begin{addmargin}[3em]{1em}
%% where $I_{k,t}$ is the observed relative abundance index, $q_k$ is the catchability coefficient for index $k$, and $V_{k,t}$ is the predicted vulnerable biomass at the time of sampling.
%% \end{addmargin}
%% The catchability coefficient $q_k$ is evaluated at its conditional maximum likelihood estimate:
%% \[
%%   q_k =\frac{1}{N_k} \sum_{t \in I_{k,t}} \ln(I_{k,t}) - \ln(V_{k,t}),
%% \]
%% where $N_k$ is the number of relative abundance observations for index $k$ (see Walters and Ludwig 1994 for more information). The negative loglikelihood for relative abundance data is given by:
%% \begin{align}
%% \ell_I &= \sum_k \sum_{t \in I_{k,t}}  \ln(\sigma_{k,t})+\frac{\epsilon_{k,t}^2}{2\sigma_{k,t}^2} \label{df31}\\
%% &\mbox{where}\nonumber\\
%% \sigma_{k,t} &= \frac{\rho \varphi^2}{ \omega_{k,t}},  \nonumber
%% \end{align}
%% \begin{addmargin}[3em]{1em}
%% where $\rho \varphi^2$ is the proportion of the total error that is associated with observation errors, and $\omega_{k,t}$ is a user specified relative weight for observation $t$ from gear $k$. The $ \omega_{k,t}$ terms allow each observation to be weighted relative to the total error $\rho \varphi^2$; for example, to omit a particular observation, set $\omega_{k,t}=0$, or to give 2 times the weight, then set  $\omega_{k,t}=2.0$.
%% \end{addmargin}
%% For the current assessment, we assumed all observations have the same variance by setting  $\omega_{k,t}=1$.  Note that if  $\omega_{k,t}=0$ then equation \ref{eq:df31} is undefined; therefore, iSCAM adds a small constant to $\omega_{k,t}$ (1e-10), which is equivalent to assuming an extremely large variance) to ensure the likelihood can be evaluated.

%% \vspace{2ex}
%% \subsubsection{Option for Non-linear CPUE Relationship}

%% The option to model relative abundance indices as a power function of vulnerable biomass was added to the version of iSCAM used for this assessment to allow replication of the approach taken in the last Strait of Gerogia Lingcod assessment (Logan et al. 2005).  This approach was taken in 2005 because the qualified commercial CPUE index used as an abunance index was not expected to be linearly related to abundance.  In this case, \ref{eq:df29} is replaced by:      
%% \begin{equation}\label{df32}
%%  V_{k,t} = (\sum_s \sum_a N_{t,a,s} e^{-\lambda_{k,t} Z_{t,a,s}} v_{k,a,s} w_{a,s})^{\psi_k}
%% \end{equation}
%% where $\psi_k$ is an exponent determining the degree of linearity between the CPUE series from gear $k$ and the vulnerable biomass available to gear $k$ in year $t$.  When $\psi_k$ is less than 1, a given change in CPUE implies a greater relative change in exploitable abundance (hyperstability); when $\psi_k$ = 1, CPUE is proportional to abundance; and when $\psi_k$ is greater than 1, a given change in CPUE implies a lesser relative chance in abundance (hyperdepletion).  The $\psi_k$ parameters for each gear $k$ were estimated by Logan et al. (2005); however, we did not attempt to estimate these in our bridging analysis due to concerns of model overparameterization.  Instead, $\psi_k$ was fixed at the values estimated by Logan et al. (2005) in scenarios that used a non-linear CPUE relationship (Table~\ref{tab:fixedExponentValues}.


%% % ********************** Table 5 ************************************
%% \begin{table}[tp]
%% \leftskip=1.5em
%% \parindent=-1.5em
%% \caption{\label{tab:fixedExponentValues} Fixed values used for exponent determining degree of linearity between vulnerable biomass and commercial CPUE (cCPUE) or recreational CPUE (rCPUE) series ($\psi_k$  in \ref{eq:df32}) when non-linear CPUE option selected.  Values are given for three different scenarios about the treatment of historic catch values in SubAreas 28 and 29 (i.e., the southeast quadrant).}
%% %\vsd \\
%% \leftskip=0em
%% \parindent=-0em
%% \begin{center}
%% \begin{tabular}{lcc} 
%% \hline \\[-1.5ex]
%% Scenario   &   $\psi_{cCPUE}$       &    $\psi_{rCPUE}$   \\ 
%% \hline %\\[-.5ex]
%% SoG & 0.878 & 1.759 \\
%% noSE & 0.646 & 0.611 \\
%% halfSE & 0.878 & 1.759 \\
%% \hline 
%% \end{tabular} 
%% \vsd
%% \end{center}
%% \end{table}


%% %\subsub{Relative Age composition Data}
%% %
%% % krHolt Note: The following text will require a few tweaks to get it to work in this template.  Is taken directly from Steve's iscam documentation.
%% %
%% %Sampling theory suggest that age composition data are derived from a multinomial distribution \citep{fournier1982general}; however, \iscam\ assumes that age-proportions are obtained from a multivariate logistic distribution \citep{schnute1995influence,richards1997visualizing}.  The main reason \iscam\ departs from the traditional multinomial model has to do with how the age-composition data are weighted in the objective function.  First, the multinomial distribution requires the specification of an effective sample size; this may be done arbitrarily or through iterative re-weighting \citep{MCALLISTER1997,gavaris2002sif}, and in the case of multiple and potentially conflicting age-proportions this procedure may fail to converge properly.  The assumed effective sample size can have a large impact on the overall model results.  
%% %
%% %A nice feature of the multivariate logistic distribution is that the age-proportion data can be weighted based on the conditional maximum likelihood estimate of the variance in the age-proportions.  Therefore, the contribution of the age-composition data to the overall objective function is ``self-weighting'' and is conditional on other components in the model.
%% %
%% %Ignoring the subscript for gear type for clarity, the observed and predicted proportions-at-age must satisfy the constraint 
%% %\[
%% % \sum_{a=1}^A p_{t,a} = 1
%% %\]
%% %for each year. The residuals between the observed ($p_{t,a}$) and predicted proportions ($\widehat{p_{t,a}}$) is given by:
%% %\begin{equation}\label{eq7}
%% %\eta_{t,a}=\ln(p_{t,a})-\ln(\widehat{p_{t,a}})-\frac{1}{A}\sum_{a=1}^A\left[\ln(p_{t,a})-\ln(\widehat{p_{t,a}}) \right].
%% %\end{equation}
%% %The conditional maximum likelihood estimate of the variance is given by
%% %\[
%% %\widehat{\tau}^2=\frac{1}{(A-1)T}\sum_{t=1}^T\sum_{a=1}^A \eta_{t,a}^2,
%% %\]
%% %and the negative loglikelihood evaluated at the conditional maximum likelihood estimate of the variance is given by:
%% %\begin{equation}\label{eq8}
%% %    \ell_A = (A-1)T \ln(\widehat{\tau}^2).
%% %\end{equation}
%% %In short, the multivariate logistic likelihood for age-composition data is just the log of the residual variance weighted by the number observations over years and ages.
%% %
%% %%Add technical details about requiring the minimum p_{t,a} to be greater than 2% "Grouping".
%% %There is also a technical detail in \ref{eq:eq7}, where observed and predicted proportions-at-age must be greater than 0.  It is not uncommon in catch-age data sets to observe 0 proportions for older, or young, age classes.  \iscam\ adopts the same approach described by \cite{richards1997visualizing} where the definition of age-classes is altered to require that $p_{t,a}\geq 0.02$ for every age in each year.  This is accomplished by grouping consecutive ages, where $p_{t,a} <0.02$, into a single age-class and reducing the effective number of age-classes in the variance calculation ($\widehat{\tau}^2$) by the number of groups created.  The choice of 2\% is arbitrary and the user can specify the minimum proportion (including 0) to consider when pooling age-proportion data.  In the case of an exact 0 in the observed age-proportions the pooling of the adjacent age-class still occurs, this ensures that \ref{eq:eq7} is defined.
%% %
%% %
%% %A \textbf{WARNING} about extremely weak year classes is required here.  A potential problem exists if in fact there is a very small cohort relative to the adjacent cohorts such that it never makes up more than say 2\% (or whatever minimum is specified) of the age-proportions in any given year.  In such cases, the information in the age-composition data about this weak year class relative to of that the adjacent (younger) year class because its always pooled into the younger year class.  \iscam\ will actually estimate two strong cohorts instead of correctly estimating one strong and one weak cohort in the following year.


%% \subsection{Stock-Recruitment}

%% Annual recruitment and the initial age-composition are treated as latent variables in iSCAM, and residuals between estimated recruits and the deterministic stock-recruitment models are used to estimate unfished spawning stock biomass and recruitment compensation.  The residuals between the estimated and predicted recruits is given by
%% \begin{equation}\label{df33}
%%     \delta_t = \ln(\bar{R}e^{w_t}) - f(B_{t-y})
%% \end{equation}
%% where $f(B_{t-y})$ is given by \ref{eq:df26}, and $y$ is the age at recruitment, which is set to 1 for this assessment.  Note that a bias correction term for the lognormal process  errors is included in  \ref{eq:df26}.

%% The negative log likelihood for the recruitment deviations is given by the normal density (ignoring the scaling constant):
%% \begin{equation}\label{df34}
%%  \ell_\delta = n\ln(\tau) + \frac{\sum_{t=1+k}^T \delta^2_t}{2\tau^2}
%% \end{equation}
%% Equations \ref{eq:df33} and \ref{eq:df34} are key for estimating unfished spawning stock biomass and recruitment compensation via the recruitment models.  The relationship between ($s_o,\beta$) and ($B_o,\kappa$) for the Ricker stock recruitment model is defined as:
%% \begin{align}
%% s_o &= \kappa/\phi_E\\
%% \beta&=%\begin{cases}
%% %\frac{\kappa-1}{B_o} \quad \mbox{Beverton-Holt}\\[1ex]
%% \frac{\ln(\kappa)}{B_o} %\quad \mbox{Ricker}
%% %\end{cases}
%% \end{align}
%% where $s_o$ is the maximum juvenile survival rate, and $\beta$ is the density effect on recruitment.

%% % Steve's original text ***********
%% %There are two alternative stock-recruitment models available in \iscam: the Beverton-Holt model and the Ricker model.  Annual recruitment and the initial age-composition are treated as latent variables in \iscam, and residuals between estimated recruits and the deterministic stock-recruitment models are used to estimate unfished spawning stock biomass and recruitment compensation.  The residuals between the estimated and predicted recruits is given by
%% %\begin{equation}\label{eq9}
%% %    \delta_t = \ln(\bar{R}e^{w_t}) - f(B_{t-k})
%% %\end{equation}
%% %where $f(B_{t-k})$ is given by either \ref{eq:T4.12} or \ref{eq:T4.13}, and $k$ is the age at recruitment.  Note that a bias correction term for the lognormal process  errors is included in  \ref{eq:T4.12} and \ref{eq:T4.13}.
%% %
%% %The negative log likelihood for the recruitment deviations is given by the normal density (ignoring the scaling constant):
%% %\begin{equation}\label{eq10}
%% % \ell_\delta = n\ln(\tau) + \frac{\sum_{t=1+k}^T \delta^2_t}{2\tau^2}
%% %\end{equation}
%% %Equations \ref{eq:eq9} and \ref{eq:eq10} are key for estimating unfished spawning stock biomass and recruitment compensation via the recruitment models.  The relationship between ($s_o,\beta$) and ($B_o,\kappa$) is defined as:
%% %\begin{align}
%% %s_o &= \kappa/\phi_E\\
%% %\beta&=\begin{cases}
%% %\frac{\kappa-1}{B_o} \quad \mbox{Beverton-Holt}\\[1ex]
%% %\frac{\ln(\kappa)}{B_o} \quad \mbox{Ricker}
%% %\end{cases}
%% %\end{align}
%% %where $s_o$ is the maximum juvenile survival rate, and $\beta$ is the density effect on recruitment.
%% % ***************************

%% \vspace{2ex}
%% \section{BAYESIAN ANALYSIS OF MODEL PARAMETERS \& POLICY PARAMETERS}

%% Bayesian estimation was done using the Markov Chain Monte Carlo (MCMC) method to approximate posterior distributions for estimated parameters.  Marginal posterior distributions of each model parameter were constructed by using the metropolis algorithm built into ADMB to sample from the joint posterior distribution.  This was accomplished by running iSCAM in -mcmc mode followed by the -mceval option.  Prior distributions, estimation bounds, and initial values for the MCMC procedure are shown in Table~\ref{tab:priors}. Marginal posterior densities were also produced for derived quantities such as MSY-based reference points using the steady-state age structured model described in Table~\ref{tab:model} and the associated text above.

%% % ********************** Table 6 ************************************
%% \begin{table}[tp]
%% \leftskip=1.5em
%% \parindent=-1.5em
%% \caption{\label{tab:priors} Details for estimation of parameters, including prior distributions with corresponding means and standard deviations, bounds between which parameters are constrained, and initial values.}
%% %\vsd \\
%% \leftskip=0em
%% \parindent=-0em
%% \begin{center}
%% \begin{tabular}{lcccc} 
%% \hline \\[-1.5ex]
%% 		&  Prior            & Mean, standard   &              & Initial\\ 
%%  Parameter    &  distribution  &  deviation            & Bounds & value\\ 
%% \hline %\\[-.5ex]
%% \multicolumn{5}{l}{\underline{SoG}}\\
%% $R_0$ & Uniform & -- & [0.5, 3 300 000] & 1 600 000\\
%% $h$ & Normal & 1.2, 10 & [0.2, 208] & 0.70\\
%% $\bar{R}$ & Uniform & -- & [0.5, 3 300 000] & 89 000 \\
%% $\vartheta$ & Gamma & 20, 10 & [0.1, 80] & 20 \\
%% \multicolumn{5}{l}{\underline{noSE}}\\
%% \vspace{1ex} \\
%% \multicolumn{5}{l}{\underline{halfSE}}\\
%% \vspace{1ex} \\

%% \hline 
%% \end{tabular} 
%% \vsd
%% \end{center}
%% \end{table}

%% \medskip

\newpage

\end{document}
